# -SQL
Тестовое задание по SQL от одного банка

Укажите СУБД, для которой пишете запрос (postgresql, oracle, sqlserver, mysql, …): _____________

      Задача 1
 
Есть таблица Table с покупками клиентов, где 
CLIENT_ID –  это идентификатор клиента,
AMOUNT – сумма совершенной покупки,
DATE – дата совершенной транзакции.

Необходимо написать запросы, которые покажут:
1.	количество клиентов магазина,
2.	за январь 2023 года для каждого клиента сумму всех его покупок, среднюю сумму покупки, максимальный размер покупки (самую дорогую),
3.	клиентов, которые совершили больше 2 покупок и количество совершенных покупок. Результат необходимо отразить по убыванию количества совершенных покупок.

      Задача 2
Есть две таблицы:
•	credit (credit_id, issued_date) – таблица со всеми выданными кредитами,
•	credit_calculations (credit_id, calculation_date, status) – таблица с описанием каждого дня жизни кредита. Поле status может принимать значения: ACTIVE (займ активен), EXPIRED (займ в просрочке), COMPLETED (займ закрылся, после этого записи в таблице credit_calculations по данному кредиту прекращаются).
Необходимо:
1.	для каждого кредита, выданного в этом году, вывести количество дней, когда он находился в просрочке (если кредит не имел просрочки, то по таким кредитам выводить значение 0),
2.	для каждого кредита вывести актуальный статус (с максимальной датой calculation_date). Здесь хотелось бы увидеть 2 варианта решения – с использованием оконной функции и без неё,
3.	разработчик случайно сделал update таблицы credit_calculations таким образом, что поля credit_id и calculation_date остались корректными, а поле status стало частично пустым (null). Требуется написать запрос, показывающий количество кредитов, по которым стали пустыми все статусы - вывести количество таких кредитов.

      Задача 3
Есть таблица employee (id, hire_date, chief_id, salary) со списком id сотрудников, их датой приёма на работу, id начальника (такой же сотрудник в таблице) и зарплатой.
Необходимо:
1.	посчитать количество сотрудников, которые работают в компании дольше, чем их непосредственные начальники,
2.	проверить, есть ли дублирующиеся строки по сотруднику (id) в таблице employee – вывести пример такого сотрудника.

      Задача 4
В банке есть 2 таблицы:
•	транзакции клиентов (могут быть как в рублях, так и в евро и долларах):  
transactions (id, transaction_date, client_id, currency, amount), пример: 
(1, '2022-05-23', 33, 'EURO', 259), 
(2, '2022-05-24', 34, 'USD', 300),
(3, '2022-05-24', 34, 'RUB', 5000),
•	ежедневный курс ЦБ евро и доллара к рублю: currency (id, currency_date, currency, value), пример: 
(1, '2022-05-23', 'EURO', 69.0),
(2, '2022-05-23', 'USD', 60),
(3, '2022-05-24', ' EURO ', 70),
(4, '2022-05-24', 'USD', 59.5).
Необходимо:
1.	вычислить стоимость всех покупок для каждого клиента, результат посчитать в рублях
(клиент 1, сумма всех покупок),
(клиент 2, сумма всех покупок)
2.	вычислить стоимость всех покупок в рублях для каждого клиента в ситуации, когда курс ЦБ есть не на все даты (в таблице валют отсутствует строка с датой). На праздники и выходные устанавливается курс ЦБ в крайний рабочий день перед ними.
(клиент 1, сумма всех покупок),
(клиент 2, сумма всех покупок)

